<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PortfÃ³lio Financeiro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; padding:20px; background:#f2f2f2 }
.card { background:#fff; padding:15px; margin-bottom:15px; border-radius:8px }
input, select, button { width:100%; padding:8px; margin-top:6px }
button { background:#1976d2; color:#fff; border:none; cursor:pointer }
table { width:100%; border-collapse:collapse }
th, td { padding:8px; border-bottom:1px solid #ddd; text-align:center }
canvas { max-width:400px; margin:auto }
</style>
</head>

<body>

<h2>ðŸ“ˆ Meu PortfÃ³lio</h2>

<div class="card">
  <input id="ativo" placeholder="Ativo (PETR4, AAPL)">
  <input id="classe" placeholder="Classe (AÃ§Ãµes, FII, ETF)">
  <input id="quantidade" type="number" placeholder="Quantidade">
  <input id="preco" type="number" placeholder="PreÃ§o mÃ©dio">
  <select id="moeda">
    <option value="BRL">BRL</option>
    <option value="USD">USD</option>
  </select>
  <button onclick="salvar()">Salvar</button>
</div>

<div class="card">
  <h3>ðŸ’° Total do PortfÃ³lio (R$): <span id="total">0.00</span></h3>
</div>

<div class="card">
  <canvas id="grafico"></canvas>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Ativo</th>
<th>Classe</th>
<th>Qtd</th>
<th>CotaÃ§Ã£o</th>
<th>Valor (R$)</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>

<script>
/* ================= CONFIGURAÃ‡ÃƒO ================= */

const API_URL = "https://script.google.com/macros/s/AKfycbxTjhorp3sSKtqPZj8Yrsg8ulnDI3XWYeSvPUGqh0BJIr_bzo_pW1CRFSUlFEDc499vRA/exec";

/* ================= FUNÃ‡Ã•ES ================= */

async function salvar() {
  const data = {
    ativo: ativo.value.toUpperCase(),
    classe: classe.value,
    quantidade: Number(quantidade.value),
    preco_medio: Number(preco.value),
    moeda: moeda.value
  };

  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(data)
  });

  carregar();
}

async function carregar() {
  const res = await fetch(API_URL);
  const dados = await res.json();
  render(dados);
}

let chart;

function render(dados) {
  let total = 0;
  let resumo = {};
  const tbody = document.getElementById("tabela");
  tbody.innerHTML = "";

  dados.forEach(d => {
    total += d.valor_total;
    resumo[d.classe] = (resumo[d.classe] || 0) + d.valor_total;

    tbody.innerHTML += `
      <tr>
        <td>${d.ativo}</td>
        <td>${d.classe}</td>
        <td>${d.quantidade}</td>
        <td>${d.cotacao_atual.toFixed(2)}</td>
        <td>${d.valor_total.toFixed(2)}</td>
      </tr>
    `;
  });

  document.getElementById("total").innerText = total.toFixed(2);
  desenharGrafico(resumo);
}

function desenharGrafico(dados) {
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById("grafico"), {
    type: "pie",
    data: {
      labels: Object.keys(dados),
      datasets: [{ data: Object.values(dados) }]
    }
  });
}

carregar();
</script>

</body>
</html>
