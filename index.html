<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard de PortfÃ³lio</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#1976d2;
  --bg:#f4f6f8;
  --card:#fff;
  --success:#2e7d32;
  --danger:#c62828;
}

body{
  margin:0;
  font-family:Inter,Arial;
  background:var(--bg);
}

header{
  background:var(--primary);
  color:#fff;
  padding:16px;
  font-size:18px;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
}

input,select,button{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
}

.badge{
  padding:4px 8px;
  border-radius:8px;
  font-size:12px;
}

.success{background:#e8f5e9;color:var(--success)}
.danger{background:#ffebee;color:var(--danger)}

.alert{
  background:#fff3cd;
  border:1px solid #ffeeba;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  text-align:center;
  font-size:13px;
}
</style>
</head>

<body>

<header>ðŸ“ˆ Meu PortfÃ³lio</header>

<div class="container">

<!-- FORMULÃRIO -->
<div class="card">
  <div class="grid">
    <input id="ativo" placeholder="Ativo (PETR4, AAPL)">
    <select id="classe">
      <option>AÃ§Ãµes</option>
      <option>FII</option>
      <option>Exterior</option>
    </select>
    <select id="tipo">
      <option value="COMPRA">Compra</option>
      <option value="VENDA">Venda</option>
    </select>
    <input id="quantidade" type="number" placeholder="Quantidade">
    <select id="moeda">
      <option value="BRL">BRL</option>
      <option value="USD">USD</option>
    </select>
  </div>
  <button onclick="salvar()" style="margin-top:12px">Salvar operaÃ§Ã£o</button>
</div>

<!-- TOTAL -->
<div class="card">
  <h3>ðŸ’° PatrimÃ´nio Total</h3>
  <h2 id="total">R$ 0,00</h2>
</div>

<!-- CARDS POR CLASSE -->
<div id="cards" class="grid"></div>

<!-- GRÃFICO -->
<div class="card">
  <canvas id="grafico"></canvas>
</div>

<!-- ALERTAS DE BALANCEAMENTO -->
<div id="alertas"></div>

<!-- POSIÃ‡Ã•ES -->
<div class="card">
  <h3>ðŸ“Œ PosiÃ§Ãµes</h3>
  <table>
    <thead>
      <tr>
        <th>Ativo</th>
        <th>Classe</th>
        <th>Qtd</th>
        <th>PreÃ§o MÃ©dio</th>
        <th>Valor</th>
        <th>Resultado</th>
      </tr>
    </thead>
    <tbody id="tabela"></tbody>
  </table>
</div>

</div>

<script>
const API_URL = "COLE_AQUI_SUA_URL_DO_APPS_SCRIPT";
let chart;

async function salvar(){
  let qtd = Number(quantidade.value);
  if(tipo.value==="VENDA") qtd*=-1;

  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      ativo:ativo.value.toUpperCase(),
      classe:classe.value,
      quantidade:qtd,
      moeda:moeda.value
    })
  });
  carregar();
}

async function carregar(){
  const r = await fetch(API_URL);
  const data = await r.json();
  render(data);
}

function render(data){
  document.getElementById("total").innerText =
    "R$ " + data.total.toFixed(2);

  renderCards(data.classes);
  renderGrafico(data.classes);
  renderTabela(data.lista);
  renderBalanceamento(data.rebalanceamento);
}

function renderCards(classes){
  const c = document.getElementById("cards");
  c.innerHTML="";
  Object.entries(classes).forEach(([k,v])=>{
    c.innerHTML+=`
      <div class="card">
        <h4>${k}</h4>
        <strong>R$ ${v.toFixed(2)}</strong>
      </div>`;
  });
}

function renderGrafico(classes){
  const labels = Object.keys(classes);
  const valores = Object.values(classes);
  if(chart) chart.destroy();
  chart = new Chart(grafico,{
    type:"doughnut",
    data:{labels,datasets:[{data:valores}]},
    options:{plugins:{legend:{position:"bottom"}}}
  });
}

function renderTabela(lista){
  const t = document.getElementById("tabela");
  t.innerHTML="";
  lista.forEach(a=>{
    t.innerHTML+=`
      <tr>
        <td>${a.ativo}</td>
        <td>${a.classe}</td>
        <td>${a.qtd}</td>
        <td>${a.preco_medio.toFixed(2)}</td>
        <td>${a.valor_atual.toFixed(2)}</td>
        <td>
          <span class="badge ${a.lucro>=0?"success":"danger"}">
            ${a.lucro.toFixed(2)} (${a.lucro_pct.toFixed(1)}%)
          </span>
        </td>
      </tr>`;
  });
}

function renderBalanceamento(reb){
  const a = document.getElementById("alertas");
  a.innerHTML="";
  reb.forEach(r=>{
    if(r.diferenca>0){
      a.innerHTML+=`
        <div class="alert">
          ðŸ‘‰ Aporte <strong>R$ ${r.diferenca.toFixed(2)}</strong> em
          <strong>${r.classe}</strong> para balancear
        </div>`;
    }
  });
}

carregar();
</script>

</body>
</html>
